<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8" />
  <title>Unity WebGL Player | 0529v1</title>
  <link rel="shortcut icon" href="TemplateData/favicon.ico" />
  <style>
    html, body {
      margin: 0; padding: 0; overflow: hidden; height: 100%; background: transparent;
    }
    /* 手機相機視訊 - 全螢幕且放最底層 */
    #camera-video {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: cover;
      z-index: 0;
      background: black;
    }
    /* Unity WebGL 容器放最上層 */
    #unity-container {
      width: 100%; height: 100%;
      position: fixed; top: 0; left: 0;
      background: transparent;
      z-index: 1;
      pointer-events: none; /* Unity canvas 預設不接受點擊，等你需要互動再改 */
    }
    canvas {
      background: transparent !important;
      display: block;
      margin: 0 auto;
      width: 100% !important;
      height: 100% !important;
      touch-action: none;
    }
    #unity-loading-bar {
      width: 100%; height: 4px;
      background: #222;
      position: fixed; bottom: 0; left: 0;
      z-index: 2;
    }
    #unity-progress-bar-full {
      width: 0%; height: 100%;
      background: #4caf50;
      transition: width 0.3s;
    }
  </style>
</head>
<body>
  <!-- 手機相機畫面 -->
  <video id="camera-video" autoplay playsinline muted></video>

  <!-- Unity WebGL畫布 -->
  <div id="unity-container">
    <canvas id="unity-canvas" width=960 height=600 tabindex="-1"></canvas>
    <div id="unity-loading-bar">
      <div id="unity-progress-bar-full"></div>
    </div>
  </div>

  <script>
    // 取得手機相機
    const video = document.getElementById('camera-video');
    navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' }, audio: false })
      .then(stream => {
        video.srcObject = stream;
      })
      .catch(err => {
        alert('無法取得相機權限，請允許使用相機');
        console.error(err);
      });

    // Unity WebGL 初始化設定
    var container = document.querySelector("#unity-container");
    var canvas = document.querySelector("#unity-canvas");
    var loadingBarFull = document.querySelector("#unity-progress-bar-full");

    function unityShowBanner(msg, type) {
      console.log(type + ": " + msg);
    }

    var buildUrl = "Build";
    var loaderUrl = buildUrl + "/ttest.loader.js";
    var config = {
      dataUrl: buildUrl + "/ttest.data",
      frameworkUrl: buildUrl + "/ttest.framework.js",
      codeUrl: buildUrl + "/ttest.wasm",
      streamingAssetsUrl: "StreamingAssets",
      companyName: "DefaultCompany",
      productName: "0529v1",
      productVersion: "0.1",
      showBanner: unityShowBanner,
      backgroundColor: {r:0, g:0, b:0, a:0}, // 透明背景
    };

    loadingBarFull.style.width = "0%";

    var script = document.createElement("script");
    script.src = loaderUrl;
    script.onload = () => {
      createUnityInstance(canvas, config, (progress) => {
        loadingBarFull.style.width = (100 * progress) + "%";
      }).then((unityInstance) => {
        loadingBarFull.style.display = "none";
        // 你可在這裡保存 unityInstance 以便互動使用
      }).catch((message) => {
        alert(message);
      });
    };

    document.body.appendChild(script);
  </script>
</body>
</html>
